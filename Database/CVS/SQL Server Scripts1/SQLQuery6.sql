--=================MEMBER_KEYS==========
SELECT *
FROM mref.ExternalType ET
;

SELECT TOP 100 M.MemberRecId, M.FirstName, M.JobLoadDate, xm.ExternalValue, ET.Code, ET.[Desc]
FROM MemberCompany M
	INNER JOIN Xref.Member XM
	ON M.MemberRecId = XM.MemberRecId AND M.CompanyMRefId = XM.CompanyMRefId
	INNER JOIN mref.ExternalType ET
	ON XM.ExternalTypeMRefId = ET.ExternalTypeMRefId --AND ET.Code = 'MP' 	
WHERE 
--XM.ExternalValue = 'N00004162488'--'010623740'--'030075420'
M.MemberRecId IN(42730)--301559)
;
--N00004162488
--=================MEMBER_KEYS==========



--Estos son los claims:
--ClaimRefID:
31564901
33303774
30605175
29612409
30009064
29051138 
--Para el [PatientControlNumber] = '030075420'

SELECT TOP 100 CODE.DIAGNOSISCODE,C.*
FROM ENTERPRISEHUB.DBO.CLAIM AS C
	    INNER JOIN ENTERPRISEHUB.DBO.CLAIMDIAGNOSIS AS CD
        ON CD.CLAIMREFID = C.CLAIMREFID
        INNER JOIN ENTERPRISEHUB.MREF.DIAGNOSISCODE AS CODE
        ON CODE.DIAGNOSISCODEMREFID = CD.DIAGNOSISCODEMREFID
        INNER JOIN ENTERPRISEINTERFACES.CVS.PREGNANCYANDNEWBORNCODES AS P
        ON P.CODE = CODE.DIAGNOSISCODE
WHERE C.SubscriberMemberMRefID = 42730--301559
	AND P.ISNEWBORNCODE <> 1
 --C.ClaimRefID IN(
	--					31564901,
	--					33303774,
	--					30605175,
	--					29612409,
	--					30009064,
	--					29051138
	--				 )
	AND C.CLAIMSTATUSCODEMREFID NOT IN (5, 13) --HEADER STATUS NOT VOID
;

SELECT TOP 100 C.ClaimRefID,C.ServiceDateFrom, C.ServiceDateTo
FROM ENTERPRISEHUB.DBO.CLAIM AS C
	    INNER JOIN ENTERPRISEHUB.DBO.CLAIMDIAGNOSIS AS CD
        ON CD.CLAIMREFID = C.CLAIMREFID
        INNER JOIN ENTERPRISEHUB.MREF.DIAGNOSISCODE AS CODE
        ON CODE.DIAGNOSISCODEMREFID = CD.DIAGNOSISCODEMREFID
        INNER JOIN ENTERPRISEINTERFACES.CVS.PREGNANCYANDNEWBORNCODES AS P
        ON P.CODE = CODE.DIAGNOSISCODE
WHERE C.SubscriberMemberMRefID = 603916--301559
	AND P.ISNEWBORNCODE <> 1
 --C.ClaimRefID IN(
	--					31564901,
	--					33303774,
	--					30605175,
	--					29612409,
	--					30009064,
	--					29051138
	--				 )
	AND C.CLAIMSTATUSCODEMREFID NOT IN (5, 13) --HEADER STATUS NOT VOID
;

SELECT *
FROM ENTERPRISEINTERFACES.CVS.PREGNANCYANDNEWBORNCODES AS P
WHERE P.ISNEWBORNCODE <> 1

SELECT *
FROM ENTERPRISEINTERFACES.CVS.PREGNANCYCOVEREDPLAN


SELECT CASE 
			WHEN (YEAR(C.SERVICEDATEFROM) < 2017)
			 THEN PREGNANCYCODE = 'Y' --SET PREGNACNCY FIELD CODE
			 ELSE PREGNANCYCODE = ''
	END AS PCODE
FROM    ENTERPRISEINTERFACES.CVS.CVSSQELETONLAYOUT AS CS
        INNER JOIN
        #TPREGMEMBERS AS PM
        ON PM.MEMBERRECID = 
        INNER JOIN
        ENTERPRISEINTERFACES.CVS.PREGNANCYCOVEREDPLAN AS PREG
        ON CS.INDVALUE = PREG.BENEFITPACKAGEID
        INNER JOIN
        ENTERPRISEHUB.DBO.CLAIM AS C
        ON PM.MEMBERRECID = C.SUBSCRIBERMEMBERMREFID
        LEFT OUTER JOIN
        ENTERPRISEHUB.DBO.CLAIMDIAGNOSIS AS CD
        ON CD.CLAIMREFID = C.CLAIMREFID
        LEFT OUTER JOIN
        ENTERPRISEHUB.MREF.DIAGNOSISCODE AS CODE
        ON CODE.DIAGNOSISCODEMREFID = CD.DIAGNOSISCODEMREFID
        INNER JOIN
        ENTERPRISEINTERFACES.CVS.PREDEGNANCYANDNEWBORNCODES AS P
        ON P.CODE = CODE.DIAGNOSISCO
WHERE   
        AND C.CLAIMSTATUSCODEMREFID NOT IN (5, 13) --HEADER STATUS NOT VOID
        AND P.ISNEWBORNCODE <> 1
        AND CS.CARRIER = PREG.CARRIER


SELECT *
FROM EnterpriseInterfaces.CVS.CVSSqeletonLayout S
WHERE 1 = 1
	AND avetaid = '010035000'--'010623740'--'030075420'
	AND INDVALUE IN('P00310749643','P00310749499')
	--AND PREGNANCYCODE = 'Y'
;

--010697421
010620763
010273005
030191491
010690079
010096978
010450362
010497801
010501213

SELECT *
FROM EnterpriseInterfaces.CVS.PregnancyCoveredPlan P
WHERE P.BenefitPackageID IN('P00310749697','P00310752464');
;

--UPDATE ENTERPRISEHUB.DBO.CLAIM
SET ServiceDateFrom = '2017-01-01', --'2016-09-21'--
ServiceDateTo = '2017-01-01'
WHERE SubscriberMemberMRefID = 301559
	AND ClaimRefID = 76400475
;

--2016-09-21 00:00:00.000

SELECT SubscriberMemberMRefID, ServiceDateFrom, ServiceDateTo
FROM ENTERPRISEHUB.DBO.CLAIM C
WHERE ClaimRefID = 76400475
